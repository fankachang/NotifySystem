# Line 通知服務 - 實作執行記錄

> 本文件記錄實作過程中遇到的問題與解決方案

## 2025-01-02

### 問題 1：Pomelo.EntityFrameworkCore.MySql 與 .NET 10 不相容

**問題描述：**
- 嘗試在 .NET 10 專案安裝 Pomelo.EntityFrameworkCore.MySql 9.0.0 後，安裝 Microsoft.EntityFrameworkCore.Design 10.0.1 時發生版本衝突
- 錯誤訊息：`NU1107: 偵測到 Microsoft.EntityFrameworkCore.Relational 有版本衝突`
- Pomelo 9.0.0 僅支援 EF Core 9.x（`>= 9.0.0 && <= 9.0.999`）

**解決方案：**
改用 Oracle 官方提供的 MySQL EF Core Provider：
```bash
dotnet remove package Pomelo.EntityFrameworkCore.MySql
dotnet add package MySql.EntityFrameworkCore --version 10.0.0-rc
```

實際安裝版本：MySql.EntityFrameworkCore 10.0.0-rc

**影響：**
- 需更新 spec.md 和 data-model.md 中的套件參考
- MySql.EntityFrameworkCore 的 API 與 Pomelo 略有不同：`UseMySQL()` vs `UseMySql()`

---

### 問題 2：Microsoft.OpenApi 3.x 與 Swashbuckle 不相容

**問題描述：**
- 安裝 Microsoft.OpenApi 3.1.1 後，Swashbuckle 設定程式碼無法編譯
- 錯誤訊息：`命名空間 'Microsoft.OpenApi' 中沒有類型或命名空間名稱 'Models'`
- OpenApi 3.x 的 API 與 Swashbuckle 預期的 1.x/2.x API 不相容

**解決方案：**
移除 Swashbuckle 和 Microsoft.OpenApi，改用 .NET 10 內建的 OpenAPI 支援：
```bash
dotnet remove package Microsoft.OpenApi
dotnet remove package Swashbuckle.AspNetCore
```

並簡化 Program.cs，使用 `app.MapOpenApi()` 提供 OpenAPI 文件。

**影響：**
- Swagger UI 路徑改為 `/openapi/v1.json`
- 暫時沒有 Swagger UI 介面（可後續使用 Scalar 或其他工具）

---

### 問題 3：Docker Compose 未安裝（使用 Podman 替代）

**問題描述：**
- 執行 `docker compose up -d mysql` 時發生錯誤
- 錯誤訊息：`exec: "docker-compose": executable file not found in $PATH`
- 開發環境使用 Podman 而非 Docker

**解決方案：**
使用 Podman 直接啟動 MySQL 容器：
```bash
podman run -d --name linenotify-mysql -p 3306:3306 \
  -e MYSQL_ROOT_PASSWORD=LineNotify@Dev2025 \
  -e MYSQL_DATABASE=linenotify \
  -e MYSQL_USER=linenotify \
  -e MYSQL_PASSWORD=LineNotify@User2025 \
  -e TZ=Asia/Taipei \
  mysql:8.0 --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci
```

**影響：**
- docker-compose.yml 仍保留供其他環境使用
- 開發環境可直接使用 podman 命令
- Podman 與 Docker 命令相容，無需修改程式碼

---


